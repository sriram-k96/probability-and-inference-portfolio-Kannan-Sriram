---
title: "07-mle-and-mm"
author: ' Sriram Kannan'
date: "`r format(Sys.time(), '%07-%11-%2021')`"
output:
  html_document:
    code_folding: hide
    toc: yes
    number_sections: yes
    toc_depth: 3
    toc_float: yes
---

#Introduction 

Maximum likelihood (MLE) and method of moments (MM) are two common methods for constructing a model.This blog post will be a tutorial on how one might use Method of Moments and Maximum Likehood Estimation to model (a) Glycohemoglobin and (b) Height of adult females. The data will be from National Health and Nutrition Examination Survey 2009-2010 (NHANES), available from the Hmisc package. The two methods will be compared and contrasted as well as the choice of distribution. 

#Methodology

```{r}
require(dplyr)
Hmisc::getHdata(nhgh)
d1 <- nhgh %>% 
  filter(sex == "female") %>% 
  filter(age >= 18) %>% 
  select(gh, ht) %>% 
  filter(1:n()<=1000)
```

We will be using the Gamma Distribution, Normal Distribution and the Weibull Distribution in this tutorial. All 3 distributions are 2 Parameter Distributions and this we will be defining 2 Sample Moments for the Method of Moments for each of the attributes we'd like to model - i.e, Glycohemoglobin (gh) and Height of adult females(ht)

```{r}
xbargh = mean(d1$gh)
s2gh = var(d1$gh)
xbarht = mean(d1$ht)
s2ht = var(d1$ht)
```

Method of Moments - Gamma Distribution
We solve a series of simultaneous equations to establish a relationship between the Population Moments to the Sample Moments. 

```{r}
shape_hatgh <- xbargh^2/s2gh 
scale_hatgh <- s2gh/xbargh

shape_hatht <- xbarht^2/s2ht 
scale_hatht <- s2ht/xbarht

Fghgamma <- function(x){
pgamma(x, shape = shape_hatgh, scale = scale_hatgh)
}

Fhtgamma <- function(x){
pgamma(x, shape = shape_hatht, scale = scale_hatht)
}

plot(ecdf(d1$gh), main = "CDF of Glycohemoglobin - Gamma Distribution")
curve(Fghgamma(x), add = TRUE, col = "blue", lwd = 3)

plot(ecdf(d1$ht), main = "CDF of Height of Adult Females - Gamma Distribution")
curve(Fhtgamma(x), add = TRUE, col = "blue", lwd = 3)

fghgamma <- function(x){dgamma(x, shape = shape_hatgh, scale = scale_hatgh)}
fhtgamma <- function(x){dgamma(x, shape = shape_hatht, scale = scale_hatht)}

hist(d1$gh, freq = FALSE, main = "PDF of Glycohemoglobin - Gamma Distribution")
curve(fghgamma(x), add = TRUE, col = "blue", lwd = 3)

hist(d1$ht, freq = FALSE, main = "PDF of Adult Females - Gamma Distribution")
curve(fhtgamma(x), add = TRUE, col = "blue", lwd = 3)

```
Method of Moments using Gamma Distribution seems to be a reasonable fit for the Height of Adult Females data as per both the generated CDF closely matching the ecdf as well as the generated PDF closely matching the histogram. The Glycohemoglobin data on the other hand seems to be a poor match for the Gamma Distribution due to sigificant variation of the generated CDF from the ecdf as well as a massive variation in the generated PDF where it fails to capture the peaks of the data. 

Method of Moments - Normal Distribution

In the Normal Distribution, since it's standardized, the Population Moments are equal to the sample moments. 

```{r}
meangh <- xbargh
stdgh <- s2gh

meanht <- xbarht
stdht <- s2ht

Fghnorm <- function(x){
pnorm(x, mean = meangh, sd = stdgh)
}

Fhtnorm <- function(x){
pnorm(x, mean = meanht, sd = stdht)
}

plot(ecdf(d1$gh))
curve(Fghnorm(x), add = TRUE, col = "blue", lwd = 3, main = "gh")

plot(ecdf(d1$ht))
curve(Fhtnorm(x), add = TRUE, col = "blue", lwd = 3, main = "ht")

fghnorm <- function(x){dnorm(x, mean = meangh, sd = stdgh)}
fhtnorm <- function(x){dnorm(x, mean = meanht, sd = stdht)}

hist(d1$gh, freq = FALSE, main = "gh")
curve(fghnorm(x), add = TRUE, col = "blue", lwd = 3, main = "gh")

hist(d1$ht, freq = FALSE, main = "ht")
curve(fhtnorm(x), add = TRUE, col = "blue", lwd = 3, main = "ht")
```
Method of Moments using the Normal Distribution seems to be a poor fit for both Glycohemoglobin as well as the Height of Adult Females as significant deviations from the ecdf and the histograms are observed in Glycohemoglobin data while the CDF and the PDF generated by moments look completely different in case of the height of Adult Females Data. 
```{r}
#Weibull Distribution 
meangh <- xbargh
stdgh <- s2gh

meanht <- xbarht
stdht <- s2ht
```

